---
export interface MarqueeItem {
  name: string;
  logo?: string;
  url?: string;
}

interface Props {
  items: MarqueeItem[];
  speed?: 'slow' | 'normal' | 'fast';
  direction?: 'left' | 'right';
  pauseOnHover?: boolean;
  reverse?: boolean;
}

const {
  items,
  speed = 'normal',
  direction = 'left',
  pauseOnHover = true,
  reverse = false
} = Astro.props;

// Duplicate items for seamless loop
const displayItems = [...items, ...items];
---

<div class={`marquee-container marquee--${speed} ${pauseOnHover ? 'pause-on-hover' : ''}`}>
  <div class={`marquee-track marquee--${direction} ${reverse ? 'marquee--reverse' : ''}`}>
    {displayItems.map((item) => (
      <div class="marquee-item">
        {item.url ? (
          <a href={item.url} target="_blank" rel="noopener noreferrer" class="marquee-link">
            {item.logo ? (
              <img src={item.logo} alt={item.name} loading="lazy" />
            ) : (
              <span class="marquee-text">{item.name}</span>
            )}
          </a>
        ) : (
          <>
            {item.logo ? (
              <img src={item.logo} alt={item.name} loading="lazy" />
            ) : (
              <span class="marquee-text">{item.name}</span>
            )}
          </>
        )}
      </div>
    ))}
  </div>
</div>

<style>
/* ===== Marquee Container ===== */
.marquee-container {
  position: relative;
  width: 100%;
  overflow: hidden;
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--color-bg-soft, #121219) 98%, transparent),
    color-mix(in oklab, var(--color-bg, #0b0b0f) 100%, transparent));
  border-top: 1px solid var(--color-border-subtle, rgba(255, 255, 255, 0.05));
  border-bottom: 1px solid var(--color-border-subtle, rgba(255, 255, 255, 0.05));
  padding: var(--space-lg, 2rem) 0;
  mask-image: linear-gradient(
    to right,
    transparent,
    black 10%,
    black 90%,
    transparent
  );
  -webkit-mask-image: linear-gradient(
    to right,
    transparent,
    black 10%,
    black 90%,
    transparent
  );
}

/* ===== Marquee Track ===== */
.marquee-track {
  display: flex;
  gap: var(--space-fluid-lg, clamp(1.5rem, 4vw, 3rem));
  width: fit-content;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}

.marquee--left {
  animation-name: scroll-left;
}

.marquee--right {
  animation-name: scroll-right;
}

.marquee--reverse .marquee-track {
  animation-direction: reverse;
}

/* ===== Speed Variants ===== */
.marquee--slow .marquee-track {
  animation-duration: 60s;
}

.marquee--normal .marquee-track {
  animation-duration: 40s;
}

.marquee--fast .marquee-track {
  animation-duration: 20s;
}

/* ===== Pause on Hover ===== */
.pause-on-hover:hover .marquee-track {
  animation-play-state: paused;
}

/* ===== Marquee Item ===== */
.marquee-item {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-sm, 1rem) var(--space-md, 1.5rem);
  background: var(--color-bg-soft, #121219);
  border: 1px solid var(--color-border-subtle, rgba(255, 255, 255, 0.08));
  border-radius: var(--radius-lg, 12px);
  transition: transform var(--transition-base, 0.18s ease),
              border-color var(--transition-base, 0.18s ease),
              box-shadow var(--transition-base, 0.18s ease);
  min-width: 140px;
  height: 80px;
}

.marquee-item:hover {
  transform: translateY(-2px);
  border-color: var(--color-accent-primary, #7A6F5F);
  box-shadow: var(--shadow-md, 0 4px 12px rgba(0, 0, 0, 0.15));
}

/* ===== Marquee Link ===== */
.marquee-link {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  text-decoration: none;
  color: inherit;
}

/* ===== Marquee Image ===== */
.marquee-item img {
  max-width: 100%;
  max-height: 50px;
  width: auto;
  height: auto;
  object-fit: contain;
  filter: grayscale(100%) brightness(0.8);
  transition: filter var(--transition-base, 0.18s ease);
}

.marquee-item:hover img {
  filter: grayscale(0%) brightness(1);
}

/* ===== Marquee Text ===== */
.marquee-text {
  font-family: var(--font-heading, 'Optima Bold', sans-serif);
  font-size: var(--text-base, 1rem);
  font-weight: var(--font-semibold, 600);
  color: var(--color-text-muted, #aeb7cb);
  white-space: nowrap;
  transition: color var(--transition-base, 0.18s ease);
}

.marquee-item:hover .marquee-text {
  color: var(--color-text-primary, #ffffff);
}

/* ===== Animations ===== */
@keyframes scroll-left {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(-50%);
  }
}

@keyframes scroll-right {
  from {
    transform: translateX(-50%);
  }
  to {
    transform: translateX(0);
  }
}

/* ===== Light Theme ===== */
:root[data-theme="light"] .marquee-container {
  background: linear-gradient(180deg,
    color-mix(in oklab, white 95%, transparent),
    color-mix(in oklab, #f6f7fb 100%, transparent));
  border-color: rgba(0, 0, 0, 0.08);
}

:root[data-theme="light"] .marquee-item {
  background: white;
  border-color: rgba(0, 0, 0, 0.10);
}

:root[data-theme="light"] .marquee-item img {
  filter: grayscale(100%) brightness(0.5);
}

:root[data-theme="light"] .marquee-item:hover img {
  filter: grayscale(0%) brightness(1);
}

:root[data-theme="light"] .marquee-text {
  color: rgba(0, 0, 0, 0.6);
}

:root[data-theme="light"] .marquee-item:hover .marquee-text {
  color: var(--color-text-primary, #000000);
}

/* ===== Motion Safety ===== */
@media (prefers-reduced-motion: reduce) {
  .marquee-track {
    animation: none;
  }

  .marquee-track {
    flex-wrap: wrap;
    justify-content: center;
  }
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .marquee-item {
    min-width: 120px;
    height: 70px;
  }

  .marquee-item img {
    max-height: 40px;
  }

  .marquee-text {
    font-size: var(--text-sm, 0.95rem);
  }
}
</style>
